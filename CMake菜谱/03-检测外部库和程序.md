# 检测外部库和程序

`cmake`提供了`find`族命令用于检测外部库和程序，它们如下:

+ `find_file`: 在相应的路径下查找文件
+ `find_library`: 查找一个库文件
+ `find_package`: 从外部项目查找和加载设置
+ `find_path`: 查找包含指定文件的目录
+ `find_program`: 查找一个可执行文件

### 1. 检测`Python`解释器

```cmake
cmake_minimum_required(VERSION 3.5 FATAL_ERROR)
project(recipe-01 LANGUAGES NONE)

find_package(PythonInterp REQUIRED)

execute_process(
	COMMAND
	${PYTHON_EXECUTABLE} "-c" "print\('Hello, World'\)"
	RESULT_VARIABLE _status
	OUTPUT_VARIABLE _hello_world
	ERROR_QUIET
	OUTPUT_STRIP_TRAILING_WHITESPACE
)
# 用于输出变量的模块
# -- _status="0" ; _hello_world="Hello, world!"
include(CMakePrintHelpers)
cmake_print_variables(_status _hello_world)
```

上面这段配置中最重要的命令就是`find_package`，正如我们前面所述，`find_package`用于查找和加载外部项目的设置，设置文件的命名通常为`Find<PackageName>.cmake`或`<PackageName>-config.cmake`。当查找到配置文件时，`<PackageName>_FOUND`变量将会被设置为`ON`。此外`find_package`命令会执行配置文件，而配置文件中通常会设置一些变量以便我们使用。

`find_package`重要的参数有以下几个：

+ `package-name`: 查找包的名称
+ `version`: 查找包的版本
+ `EXACT`: 如果设置了该参数，找到包的版本必须和要求的版本一致。
+ `MOUDLE`: 如果设置了该参数，将会以`MOUDLE`的模式查找包。
+ `CONFIG`: 如果设置了该参数，将会以`CONFIG`的模式查找包。
+ `REQUIRED`: 如果设置了该参数，如果找不到包，将会停止配置。
+ `COMPONENTS`: 该参数后面跟要查找的组件。
+ `OPTIONAL_COMPONENTS`: 该参数后跟可选的组件。

`linux`下搜索前缀下的搜索路径

```txt
<prefix>/(lib/<arch>|lib*|share)/cmake/<name>*/                 (U)
<prefix>/(lib/<arch>|lib*|share)/<name>*/                       (U)
<prefix>/(lib/<arch>|lib*|share)/<name>*/(cmake|CMake)/         (U)
<prefix>/<name>*/(lib/<arch>|lib*|share)/cmake/<name>*/         (W/U)
<prefix>/<name>*/(lib/<arch>|lib*|share)/<name>*/               (W/U)
<prefix>/<name>*/(lib/<arch>|lib*|share)/<name>*/(cmake|CMake)/ (W/U)
```

注意这里的`prefix`仅适用于系统或`cmake`预先设置的变量中存储的路径。

比如环境变量`CMAKE_SYSTEM_PREFIX_PATH`设置了搜索前缀`/usr//usr/local/usr/lib`，然后再搜索包时会根据上面的组合组成不同的路径进行搜索。

此外我们还需注意该命令的搜索流程：

1. 首先在`<PackageName>_ROOT`变量中指定的路径中进行搜索。这个变量是用户自己手动设置的，我们可以手动设置该变量为要查找的配置文件的路径。

2. 在`cmake`特定的缓存变量中的路径中进行搜索

   ```txt
   CMAKE_PREFIX_PATH
   CMAKE_FRAMEWORK_PATH
   CMAKE_APPBUNDLE_PATH
   ```

3. 在下列环境变量中声明的路径作为前缀进行搜索

   ```txt
   <PackageName>_DIR
   CMAKE_PREFIX_PATH
   CMAKE_FRAMEWORK_PATH
   CMAKE_APPBUNDLE_PATH
   ```

4. 在`HINTS`选项中指定的路径中进行搜索。

5. 在标准环境变量`PATH`指定的路径作为前缀进行搜索。

6. 在下面的变量中设置的路径作为前缀进行搜索

   ```txt
   CMAKE_SYSTEM_PREFIX_PATH
   CMAKE_SYSTEM_FRAMEWORK_PATH
   CMAKE_SYSTEM_APPBUNDLE_PATH
   ```

7. 在`PATHS`选项指定路径中进行搜索。